  <?php
require_once('connection.php');
require_once('functions.php');

  $firstname = $lastname = $email = $password = $cpassword = "";
  $firstname_err = $lastname_err = $emailErr = $passwordErr = $cpasswordErr = "";
  $success = "";

  if($_SERVER["REQUEST_METHOD"] == "POST") {
    if(empty($_POST['firstname'])) {
      $firstname_err = "Frist name is required";
    }else {
      $firstname = $database->mysql_entities_fix_string(test_input($_POST['firstname']));

      if (!preg_match("/^[A-Za-z ]*$/", $firstname)) {
        $firstname_err = "Only letters and white space allowed";
      }
    }

    if(empty($_POST['lastname'])) {
      $lastname_err = "Last name is required";
    }else {
      $lastname = $database->mysql_entities_fix_string(test_input($_POST['lastname']));
      if (!preg_match("/^[A-Za-z ]*$/", $lastname)) {
        $lastname_err = "Only letters and white space allowed";
      }
    }


    if (empty($_POST['email'])) {
      $emailErr = "Email is required";
    }else {
      $email = $database->mysql_entities_fix_string(test_input($_POST['email']));
      if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $emailErr = "Invalid email format";
      }
    }


    if(!empty($_POST["password"]) && ($_POST["password"] == $_POST["cpassword"])) {
    $password = $database->mysql_entities_fix_string(test_input($_POST["password"]));
    $cpassword = $database->mysql_entities_fix_string(test_input($_POST["cpassword"]));
    if (strlen($_POST["password"]) < '8') {
        $passwordErr = "Your Password Must Contain At Least 8 Characters!";
    }
    elseif(!preg_match("#[0-9]+#",$password)) {
        $passwordErr = "Your Password Must Contain At Least 1 Number!";
    }
    elseif(!preg_match("#[A-Z]+#",$password)) {
        $passwordErr = "Your Password Must Contain At Least 1 Capital Letter!";
    }
    elseif(!preg_match("#[a-z]+#",$password)) {
        $passwordErr = "Your Password Must Contain At Least 1 Lowercase Letter!";
    }
}
elseif(!empty($_POST["password"])) {
    $cpasswordErr = "Please Check You've Entered Or Confirmed Your Password!";
} else {
     $passwordErr = "Please enter password   ";
      $cpasswordErr = "Confirm password   ";
}

if($firstname_err == "" && $lastname_err == "" && $emailErr == "" && $passwordErr == "" && $cpasswordErr == "") {

$stmt = $database->prepare_query('insert into admin values (?, ?, ?, ?)');
$stmt->bind_param('ssss', $firstname, $lastname, $email, $password);
$stmt->execute();
$stmt->close();
$database->close_connection();
$success =  "You have been successfully registered.";
}



  }

?>

<!DOCTYPE html>
<html>
<head>
	<title>Register now</title>
	<link href="main.css" media = "all" rel="stylesheet" type="text/css" />
</head>
<body>

	<h2 style="text-align: center; padding-top: 30px;">Enter the following</h2>
	<div id="registeruser">
		<form class="info" method="post" action=" <?php echo htmlspecialchars($_SERVER['PHP_SELF']); ?>">
			<label>First Name: </label><span class="error">*<?php echo "$firstname_err"; ?></span>
			<input type="text" name="firstname" id="inputmalware">
			
		
			<label>Last Name: </label><span class="error">*<?php echo "$lastname_err"; ?></span>
			<input type="text" name="lastname" id="inputmalware">

			<label style="margin-bottom: 10px;">Email:    </label> <span class="error">*<?php echo "$emailErr"; ?></span>
			<input type="email" name="email" id="inputmalware">
	
			<label>Password: </label><span class="error">*<?php echo "$passwordErr"; ?></span>
			<input type="password" name="password" id="inputmalware">
			<label>Confirm Password: </label><span class="error">*<?php echo "$cpasswordErr"; ?></span>
			<input type="password" name="cpassword" id="inputmalware">
			
			<input class="search" type="submit" name="submit" id="inputmalware" value="Submit">

			<h4><?php echo $success; ?></h4>
		</form>

	</div>

</body>
</html>
